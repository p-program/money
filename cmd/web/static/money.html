<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>企业展示 — 最大面值京巴布韦纸币（可替换头像）</title>
  <style>
    /* 全局重置 */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0
    }

    html,
    body {
      height: 100%
    }

    body {
      font-family: Inter, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, #e9f3ff 0%, #f7fbff 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px;
      color: #0b2a3a;
    }

    /* 容器 */
    .note-wrapper {
      width: min(1100px, 95vw);
      display: flex;
      flex-direction: column;
      gap: 18px;
      align-items: center;
    }

    header {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center
    }

    header h1 {
      font-size: 1.1rem;
      letter-spacing: 0.02em
    }

    header p {
      font-size: 0.85rem;
      color: #2b5568;
      opacity: .85
    }

    /* 纸币外观（响应式） */
    .banknote {
      width: 100%;
      aspect-ratio: 3.5 / 1.6;
      /* 宽：高的比例，纸币外形 */
      background: linear-gradient(90deg, #f6e7c8 0%, #f5e2b8 30%, #f6e7c8 100%);
      border-radius: 18px;
      box-shadow: 0 18px 40px rgba(6, 21, 40, 0.18);
      position: relative;
      overflow: hidden;
      padding: 28px 30px;
      display: flex;
      gap: 20px;
      align-items: center;
    }

    /* 细节纹理 — 左侧花纹 */
    .banknote::before {
      content: "";
      position: absolute;
      left: 8%;
      top: 6%;
      width: 12%;
      height: 88%;
      background: repeating-linear-gradient(180deg, rgba(0, 0, 0, 0.02) 0 2px, transparent 2px 8px);
      transform: skewX(-12deg);
      opacity: 0.35;
      border-radius: 6px;
    }

    /* 票面数字 / 公司名 */
    .note-text {
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex: 1;
      min-width: 0;
    }

    .denomination {
      font-weight: 800;
      font-size: 2.6rem;
      letter-spacing: 0.02em;
      color: #2d3b3f;
    }

    .company {
      font-size: 1rem;
      color: #1f4856
    }

    .serial {
      font-family: monospace;
      font-size: 0.85rem;
      color: #1b3a44;
      opacity: .7
    }

    .note-desc {
      margin-top: 8px;
      color: #163241;
      opacity: .9
    }

    /* 头像区域 */
    .portrait-area {
      width: 28%;
      min-width: 140px;
      max-width: 220px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 8px;
      cursor: pointer
    }

    .portrait {
      width: 100%;
      aspect-ratio: 1/1;
      border-radius: 50%;
      overflow: hidden;
      border: 8px solid rgba(255, 255, 255, 0.8);
      box-shadow: 0 8px 18px rgba(3, 22, 38, 0.18);
      background: linear-gradient(180deg, #e9f6ff, #dff3ff);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative
    }

    .portrait img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block
    }

    .portrait .placeholder {
      font-size: .9rem;
      color: #13506a;
      opacity: .9;
      text-align: center;
      padding: 12px
    }

    .portrait-caption {
      font-size: .85rem;
      color: #083143
    }

    /* 控件栏 */
    .controls {
      display: flex;
      gap: 10px;
      align-items: center
    }

    .btn {
      background: #0c6b86;
      color: white;
      padding: 10px 14px;
      border-radius: 10px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 6px 12px rgba(12, 107, 134, 0.18)
    }

    .btn.ghost {
      background: transparent;
      color: #0c6b86;
      border: 2px solid rgba(12, 107, 134, 0.12)
    }

    input[type=file] {
      display: none
    }

    /* 响应式调整 */
    @media (max-width:720px) {
      .banknote {
        flex-direction: column;
        aspect-ratio: 4 / 3;
        padding: 18px
      }

      .portrait-area {
        width: 36%;
        max-width: 160px
      }

      .denomination {
        font-size: 2rem
      }
    }

    /* 简单提示 */
    .hint {
      font-size: 0.85rem;
      color: #1b3a44;
      opacity: .8
    }

    footer {
      margin-top: 6px;
      font-size: 0.78rem;
      color: #12323a;
      opacity: .8
    }
  </style>
</head>

<body>
  <div class="note-wrapper">
    <header>
      <h1 style="display: none;">以“京巴布韦”最大面值纸币为灵感</h1>
      <p style="display: none;">点击头像更换为你的图片（支持拖拽选择）。</p>
    </header>

    <main class="banknote" role="img" aria-label="最大面值京巴布韦纸币（可替换头像）">
      <div class="portrait-area" id="portraitArea" title="点击以更换头像">
        <div class="portrait" id="portrait">
          <div class="placeholder">点击或拖拽图片到此处</div>
          <!-- 实际头像 img 元素由 JS 插入 -->
        </div>
        <div class="portrait-caption" style="display: none;">公司 / 个人头像</div>
        <!-- 隐藏文件输入：用于文件选择 -->
        <input type="file" id="fileInput" accept="image/*" aria-label="上传头像图片" />
      </div>

      <div class="note-text">
        <div style="display:flex;align-items:flex-end;gap:12px;justify-content:space-between;">
          <div>
            <div class="denomination">$100,000,000</div>
            <div class="company">京巴布韦企业集团</div>
          </div>
          <div class="serial">S/N: JZ-2025-0811</div>
        </div>

        <div class="note-desc">夜航爭渡泥水澀，牽挽直欲來瓜洲</div>

        <div style="margin-top:auto;display:flex;justify-content:space-between;align-items:center;gap:12px;">
          <div class="hint">复古纸币纹理 + 现代企业审美</div>
          <div class="controls">
            <button class="btn" id="replaceBtn">更换头像</button>
            <button class="btn ghost" id="resetBtn">重置</button>
            <button class="btn" id="exportBtn">导出 PNG</button>
          </div>
        </div>
      </div>
    </main>

    <footer>提示：替换后的头像仅在本地浏览器显示，不会上传到服务器。</footer>
  </div>

  <script>
    // 元素
    const portraitArea = document.getElementById('portraitArea');
    const portrait = document.getElementById('portrait');
    const fileInput = document.getElementById('fileInput');
    const replaceBtn = document.getElementById('replaceBtn');
    const resetBtn = document.getElementById('resetBtn');
    const exportBtn = document.getElementById('exportBtn');

    let currentImage = null; // HTMLImageElement

    // 点击 portrait 或按钮 弹出文件选择
    function openFilePicker() { fileInput.click(); }
    portraitArea.addEventListener('click', openFilePicker);
    replaceBtn.addEventListener('click', openFilePicker);

    // 文件选择处理
    fileInput.addEventListener('change', (ev) => {
      const file = ev.target.files && ev.target.files[0];
      if (!file) return;
      if (!file.type.startsWith('image/')) { alert('请选择图片文件'); return; }
      const url = URL.createObjectURL(file);
      setPortraitImage(url);
      // 释放 objectURL 在图片加载完成后
    });

    // 支持拖拽到头像区
    ;['dragenter', 'dragover'].forEach(evt => portraitArea.addEventListener(evt, e => { e.preventDefault(); portraitArea.style.outline = '3px dashed rgba(12,107,134,0.25)'; }));
    ;['dragleave', 'drop'].forEach(evt => portraitArea.addEventListener(evt, e => { e.preventDefault(); portraitArea.style.outline = 'none'; }));
    portraitArea.addEventListener('drop', e => {
      const dt = e.dataTransfer;
      if (!dt) return;
      const file = dt.files && dt.files[0];
      if (!file) return;
      if (!file.type.startsWith('image/')) { alert('请拖入图片文件'); return; }
      const url = URL.createObjectURL(file);
      setPortraitImage(url);
    });

    // 将图片展示到 .portrait 中
    function setPortraitImage(src) {
      // 清除占位符
      const ph = portrait.querySelector('.placeholder');
      if (ph) ph.style.display = 'none';

      // 如果已有 img，替换 src；否则创建
      let img = portrait.querySelector('img');
      if (!img) {
        img = document.createElement('img');
        portrait.appendChild(img);
      }
      img.src = src;
      currentImage = img;

      // 当图片加载完成后释放 object URL（如果有）
      img.onload = () => {
        try { if (src.startsWith('blob:')) URL.revokeObjectURL(src); } catch (e) { }
        img.dataset.ow = img.naturalWidth;
        img.dataset.oh = img.naturalHeight;
      }
    }

    // 重置
    resetBtn.addEventListener('click', () => {
      const img = portrait.querySelector('img');
      if (img) img.remove();
      const ph = portrait.querySelector('.placeholder');
      if (ph) ph.style.display = '';
      currentImage = null;
      fileInput.value = '';
    });

    // 导出为 PNG（使用 Canvas 手动绘制）
    exportBtn.addEventListener('click', async () => {
      // canvas 大小按当前 banknote DOM 宽高计算，放大 2x 以便清晰
      const banknote = document.querySelector('.banknote');
      const rect = banknote.getBoundingClientRect();
      const scale = 2; // 导出放大倍数
      const cw = Math.round(rect.width * scale);
      const ch = Math.round(rect.height * scale);

      const canvas = document.createElement('canvas');
      canvas.width = cw; canvas.height = ch;
      const ctx = canvas.getContext('2d');

      // 绘制背景（与 CSS 近似）
      // 底色
      const grad = ctx.createLinearGradient(0, 0, cw, 0);
      grad.addColorStop(0, '#f6e7c8');
      grad.addColorStop(0.3, '#f5e2b8');
      grad.addColorStop(1, '#f6e7c8');
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, cw, ch);

      // 左侧纹理
      ctx.save();
      ctx.globalAlpha = 0.25;
      ctx.translate(cw * 0.08, ch * 0.06);
      ctx.transform(1, 0, -0.2, 1, 0, 0);
      ctx.fillStyle = '#000000';
      for (let y = 0; y < ch; y += 10) { ctx.fillRect(0, y, cw * 0.12, 2); }
      ctx.restore();

      // 票面文字
      ctx.fillStyle = '#2d3b3f';
      ctx.font = `${Math.round(44 * scale)}px serif`;
      ctx.textBaseline = 'top';
      ctx.fillText('$100,000,000,000', Math.round(40 * scale), Math.round(36 * scale));

      ctx.font = `${Math.round(16 * scale)}px sans-serif`;
      ctx.fillText('京巴布韦企业集团', Math.round(40 * scale), Math.round(36 * scale + 54 * scale));

      ctx.font = `${Math.round(12 * scale)}px monospace`;
      ctx.fillText('S/N: JZ-2025-0811', cw - Math.round(220 * scale), Math.round(36 * scale));

      // 画头像：根据 portrait DOM 的位置绘制
      const portraitDom = document.getElementById('portrait');
      const portraitRect = portraitDom.getBoundingClientRect();
      // 计算相对于 banknote 的偏移
      const bankRect = banknote.getBoundingClientRect();
      const px = Math.round((portraitRect.left - bankRect.left) * scale);
      const py = Math.round((portraitRect.top - bankRect.top) * scale);
      const pw = Math.round(portraitRect.width * scale);
      const phh = Math.round(portraitRect.height * scale);

      // 绘制头像背景圆（白边）
      ctx.save();
      const border = Math.round(8 * scale);
      ctx.beginPath();
      ctx.arc(px + pw / 2, py + phh / 2, Math.min(pw, phh) / 2 + border / 2, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(255,255,255,0.9)';
      ctx.fill();
      ctx.restore();

      // 如果有图片，直接使用 currentImage 绘制裁切为圆形
      if (currentImage && currentImage.src) {
        ctx.save();
        ctx.beginPath();
        ctx.arc(px + pw / 2, py + phh / 2, Math.min(pw, phh) / 2, 0, Math.PI * 2);
        ctx.clip();

        let sw = currentImage.naturalWidth;
        let sh = currentImage.naturalHeight;
        if (currentImage.dataset.ow && currentImage.dataset.oh) {
          sw = parseInt(currentImage.dataset.ow);
          sh = parseInt(currentImage.dataset.oh);
        }
        const ratio = Math.max(pw / sw, phh / sh);
        const dw = sw * ratio;
        const dh = sh * ratio;
        const dx = px + (pw - dw) / 2;
        const dy = py + (phh - dh) / 2;

        ctx.drawImage(currentImage, dx, dy, dw, dh);
        ctx.restore();
      } else {
        // 占位文字
        ctx.fillStyle = '#13506a';
        ctx.font = `${Math.round(12 * scale)}px sans-serif`;
        ctx.textAlign = 'center';
        ctx.fillText('点击或拖拽图片到此处', px + pw / 2, py + phh / 2 - 8 * scale);
      }

      // 生成下载链接
      const dataURL = canvas.toDataURL('image/png');
      const a = document.createElement('a');
      a.href = dataURL; a.download = 'money.png';
      a.click();
    });

    // Helper: draw image into canvas clipped as circle and cover-fit
    function drawImageInCircle(ctx, src, x, y, w, h, opts = {}) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = 'anonymous';
        img.onload = () => {
          ctx.save();
          ctx.beginPath();
          ctx.arc(x + w / 2, y + h / 2, Math.min(w, h) / 2, 0, Math.PI * 2);
          ctx.clip();

          let sx = 0, sy = 0, sw = img.width, sh = img.height;
          if (opts.sx !== undefined) {
            sx = opts.sx; sy = opts.sy; sw = opts.sw; sh = opts.sh;
          }

          const ratio = Math.max(w / sw, h / sh);
          const dw = sw * ratio;
          const dh = sh * ratio;
          const dx = x + (w - dw) / 2;
          const dy = y + (h - dh) / 2;

          ctx.drawImage(img, sx, sy, sw, sh, dx, dy, dw, dh);
          ctx.restore();
          resolve();
        };
        img.onerror = (e) => { console.error('image load error', e); resolve(); };
        img.src = src;
      });
    }

    // 可选：键盘可访问性（按 Enter 打开文件选择）
    portraitArea.tabIndex = 0;
    portraitArea.addEventListener('keydown', e => { if (e.key === 'Enter' || e.key === ' ') openFilePicker(); });
  </script>
</body>

</html>